{% extends "base.html" %}
{% load static %}

{% block head%}<link rel="stylesheet" href="{% static 'css/index.css'%}">
<link rel="stylesheet" href="{% static 'main/main_page.css'%}">{% endblock head %}
{% block title %}Хакатон{% endblock title %}
{% block content %}
{% include "header.html" %}
    <div class="base-container d-flex w-100 h-100 p-3 mx-auto flex-column">
        <main role="main">
            <h1 class="cover-heading display-4" style="    font-size: 6em;">Хакатон</h1>
            <img src="{%static 'svg/code_typing.svg'%}" alt="кодеры кодят код" style="width: 80%; margin-top: 3%; margin-bottom: 2%;">
            <p class="lead">Та шо тут сложного просто береш и кодиш</p>
            {%if not request.user.is_authenticated%}
            <p class="lead"></p>
                <a href="/auth" class="btn btn-lg btn-green">Регистрация</a>
            </p>
            {%endif%}
            <div class="container mt-5">
                <h1 class="cover-heading display-4 mb-3">Когда??</h1>
                <p class="lead" style="font-size: xx-large">Начало <span class="span-date" id="start"></span></p>
                <p class="lead" style="font-size: xx-large">Окончание <span class="span-date" id="end"></span></p>
            </div>
            <div class="container mt-5">
                <h1 class="cover-heading display-4 mb-1">Участников</h1>
                <p class="lead big-number" id="users">0</p>
            </div>
            <div class="container mt-5">
                <h1 class="cover-heading display-4 mb-1">Зарегистрировано команд</h1>
                <p class="lead big-number" id="teams">0</p>
            </div>
        </main>

    </div>
    {% endblock content %}
    {%block scripts%}
    <script src="{% static 'js/number increase.js' %}"></script>
    <script>
        function getTeams() {
            let send={"action":"get-data"}
            $.ajax({
                url: '/ajax',
                method: 'get',
                dataType: 'json',
                data: send,
                success: function (data) {
                    console.log(data);
                    if (data['start-date']!=null){$("#start").text(formDateTime(data['start-date']))};
                    if (data['end-date']!=null){$("#end").text(formDateTime(data['end-date']))};
                    if (data['users-count']!=null && $("#users").text()!=data['users-count']){Increase(Number(data['users-count']), 'users', false)};
                    if (data['teams-count']!=null&& $("#teams").text()!=data['teams-count']){Increase(Number(data['teams-count']), 'teams', false)};
                },
                error: function () {
                    console.log("Ошибка подключения к серверу");
                }
            });
            setTimeout(getTeams, 60000);
        }
        let months = {0:"января", 1:"февраля", 2:"марта", 3:"апреля", 4:"мая", 5:"июня", 6:"июля", 7:"августа", 8:"сентября", 9:"октября", 10:"ноября", 11:"декабря"};
        function formDateTime(datetime){
            let d=new Date(datetime);
            let h=d.getHours();
            let m=d.getMinutes();
            if(d.getHours()<10){
                h="0"+d.getHours();
            }
            if(d.getMinutes()<10){
                m="0"+d.getMinutes();
            }
            return d.getDate()+' '+months[d.getMonth()]+' '+d.getFullYear()+' '+h+":"+m;
        }
        getTeams();
    </script>
    {%endblock%}