{% extends "base.html" %}
{% load static %}
<!-- https://bootstrap-4.ru/docs/4.0/components/navs/#javascript-behavior -->
{% block header%}
<link rel="stylesheet" href="{% static 'css/index.css'%}">
<link rel="stylesheet" href="{% static 'css/svg.css'%}">
<link rel="stylesheet" href="{% static 'css/score.css'%}">
<link rel="stylesheet" href="{% static 'css/join.css'%}">
{% endblock header %}
{% block title %}Хакатон|Команда{% endblock title %}
{% block content %}
<div class="base-container d-flex w-100 h-100 p-3 mx-auto flex-column">
    <header class="mb-auto">
        <div class="">
            <h3 class="header-title">Хакатон</h3>
            {% if request.user.is_authenticated %}
            <p>{{ request.user.first_name }}</p> <a href="../auth/logout"
                class="btn btn-secondary btn-sm btn-red header-logout">Выйти</a>
            {% else %}
            <a href="/auth/login" class="btn btn-secondary btn-sm btn-blue header-login">Войти</a>
            <a href="/auth/join" class="btn btn-secondary btn-sm btn-green header-join mr-1">Регистрация</a>
            {% endif %}
        </div>
    </header>
    <main role="main" class="inner cover">
        <h1 class="cover-heading">{{team_name}}</h1>


        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="score-tab" data-toggle="tab" href="#score" role="tab"
                    aria-controls="score" aria-selected="true">Счет</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="members-tab" data-toggle="tab" href="#members" role="tab"
                    aria-controls="members" aria-selected="false">Участники</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="info-tab" data-toggle="tab" href="#info" role="tab" aria-controls="contact"
                    aria-selected="false">Информация</a>
            </li>
            {%if lider_id is request.user.id%}
            <li class="nav-item">
                <a class="nav-link" id="manage-tab" data-toggle="tab" href="#manage" role="tab" aria-controls="contact"
                    aria-selected="false">Управление</a>
            </li>
            {%endif%}
        </ul>


        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="score" role="tabpanel" aria-labelledby="score-tab">
                <h2>Счет</h2>
                <br>
                <div class="trophy">
                    <div class="score-div">
                        <p class="score-p" id="score">0</p>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="members" role="tabpanel" aria-labelledby="members-tab">
                {%for i in members%}
                <div class="row mb-3">
                    <div class="col-1 themed-grid-col">{%if i.id is lider_id%} <svg width="1.3em" height="1.3em"
                            viewBox="0 0 16 16" class="bi bi-star-fill" fill="gold" xmlns="http://www.w3.org/2000/svg"
                            style="margin-left:100%">
                            <path
                                d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.283.95l-3.523 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                        </svg> {%endif%}</div>
                    <div class="col-3 themed-grid-col">{{i.first_name}} {{i.last_name}}</div>
                    <div class="col-3 themed-grid-col"><a href="mailto:{{i.email}}">{{i.email}}</a></div>
                    <div class="col-3 themed-grid-col">{{i.specialization}}</div>
                </div>
                {%endfor%}
            </div>
            <div class="tab-pane fade" id="info" role="tabpanel" aria-labelledby="info-tab">
                <h3>Описание</h3>
                <p>{{discription}}</p>
                <br>
                <h3>Ссылка для связи</h3>
                <a href="{{link}}" target="_blank">{{link}}</a>
            </div>
            {%if lider_id is request.user.id%}
            <div class="tab-pane fade show active" id="manage" role="tabpanel" aria-labelledby="manage-tab">
                <div id="message" class="base-container d-flex w-100 h-100 p-3 mx-auto flex-column">
                    <form class="form mt-5" id="form" action=""><!-- method="POST" onsubmit="sendForm()"  -->
                        {% csrf_token %}
                        <input type="text" name="team" placeholder="Название команды" value="{{team_name}}"
                            oninput="checkForm()" class="form-control mt-1" maxlength="100">
                        <textarea type="text" name="disc" placeholder="Описание" value="{{discription}}"
                            oninput="checkForm()" class="form-control mt-1" rows="5">{{discription}}</textarea>
                        <input type="text" name="link" placeholder="Ссылка для связи" value="{{link}}"
                            oninput="checkForm()" class="form-control mt-1" maxlength="2048">
                        <input type="button" value="Отправить" class="btn btn-green mt-3" id="submit" disabled>
                    </form>
                    <div id="result_form"></div> 
                </div>
                {%endif%}
                <script>
                    let team = document.getElementsByName('team');
                    let disc = document.getElementsByName('disc');
                    let link = document.getElementsByName('link');
                    let sub = document.getElementById("submit");
                    let l_team = team[0].value;
                    let l_disc = disc[0].value;
                    let l_link = link[0].value;
                    function checkForm() {
                        if ((team[0].value != l_team || disc[0].value != l_disc || link[0].value != l_link) && (team[0].value != '' && disc[0].value != '' && link[0].value != '')) {
                            sub.disabled = false;
                        }
                        else {
                            sub.disabled = true;
                        }
                    }
                    // function sendForm(){
                    //     form = document.getElementById('form');
                    //     form.submit();
                    // }
                </script>
                <script>
                    $("#submit").click(function () {
                        jQuery.ajax({
                            url: 'http://127.0.0.1:8000/team/manageteam',
                            method: 'post',
                            dataType: 'html',
                            data: $("#form").serialize(),
                            success: function (data) {
                                $('#result_form').html(data);
                            },
                            error: function (response) {
                                $('#result_form').html("error");
                            }
                        });
                    });
                </script>
            </div>


        </div>
        <br>
        {%if lider_id is request.user.id%}
        <input type="text" value="{{url}}" id="url" style="min-height: 38px;" readonly="readonly"> <a onclick="copy()"
            class="btn btn-primary">Копировать</a>
        {%endif%}
    </main>
    <!-- <footer class=" mastfoot mt-auto">
            <div class="inner">
                <p>Machalka</p>
            </div>
        </footer> -->
</div>
<script>
    function copy() {
        copy_text = document.getElementById('url');
        copy_text.select();
        copy_text.setSelectionRange(0, 99999);
        document.execCommand("copy");
    }
</script>
<!-- <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script> -->
<script src="{% static 'js/number increase.js' %}"></script>
<script src="{% static 'js/team/data update.js' %}"></script>
<!-- <script src="{% static 'js/team/ajax.js' %}"></script> -->
<!-- <script>getScore('{{team_name}}','score');</script> -->
{% endblock content %}