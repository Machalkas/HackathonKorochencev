{% extends "base.html" %}
{% load static %}
<!-- https://bootstrap-4.ru/docs/4.0/components/navs/#javascript-behavior -->
<!-- https://bootstrap-4.ru/docs/4.0/components/dropdowns/ -->
<!-- https://bootstrap-4.ru/docs/4.0/components/modal/ -->
<!-- https://getbootstrap.com/docs/4.0/components/card/ -->
{% block header%}
<link rel="stylesheet" href="{% static 'css/index.css'%}">
<!-- <link rel="stylesheet" href="{% static 'css/svg.css'%}"> -->
<!-- <link rel="stylesheet" href="{% static 'css/score.css'%}"> -->
<link rel="stylesheet" href="{% static 'css/join.css'%}">
{% endblock header %}
{% block title %}Хакатон|Задания{% endblock title %}
{% block content %}
<div class="base-container d-flex w-100 h-100 p-3 mx-auto flex-column">
    <header class="mb-auto">
        <div class="">
            <h3 class="header-title">Хакатон</h3>
            {% if request.user.is_authenticated %}
            <p>{{ request.user.first_name }}</p> <a href="../auth/logout"
                class="btn btn-secondary btn-sm btn-red header-logout">Выйти</a>
            {% else %}
            <a href="/auth/login" class="btn btn-secondary btn-sm btn-blue header-login">Войти</a>
            <a href="/auth/join" class="btn btn-secondary btn-sm btn-green header-join mr-1">Регистрация</a>
            {% endif %}
        </div>
    </header>
    <h1 style="padding-bottom: 1em;">Задания</h1>
    <main role="main" id="main" class="inner cover">
        <!-- список заданий -->
    </main>

    <!-- модальное окно -->
    <div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modal-title"></h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body" id="modal-body">
            </div>
            <div class="modal-footer" id="modal-footer">
            </div>
          </div>
        </div>
      </div>
    <!-- <footer class=" mastfoot mt-auto">
            <div class="inner">
                <p>Machalka</p>
            </div>
        </footer> -->
</div>
{% endblock content %}
{%block scripts%}
<script>var token = '{{csrf_token}}'; var user_pk={{request.user.pk}};</script>
<!-- <script src="{% static 'data update.js' %}"></script> -->
<!-- <script src="{% static 'ajax.js' %}"></script> -->
<!-- <script>update(team_pk,'score');</script> -->
<style>
.card-title-complited{
    color: darkgray;
}
.complited{
    position: absolute;
    top: 0.95em;
    right: 1em;
    color: black;
}
.card{
    border-width: 2px;
}
.card:hover{
    border-color:black;
}
</style>
<script>
    var x=null;
    function createTasks(active, complited){
        let m = document.getElementById("main");
        let cards = "";
        for (let i=0; i<active.length; i++){
            if(active[i]['task'].length>=483){
                active[i]['task']=active[i]['task'].slice(0,483)+"..."
            }
            cards+='<div class="card bg-light mb-4" style="max-width: 30rem; margin-left: auto; margin-right: auto;">\n<div class="card-header"><h5>'+active[i]["title"]+'</h5></div>\n<div class="card-body">\n<p class="card-text">'+active[i]['task']+'</p>\n</div>\n</div>\n';
        }
        for (let i=0; i<complited.length; i++){
            if(complited[i]['task'].length>=483){
                complited[i]['task']=complited[i]['task'].slice(0,483)+"..."
            }
            cards+='<div class="card bg-light mb-4" style="max-width: 30rem; margin-left: auto; margin-right: auto;">\n<div class="card-header"><h5 class="card-title-complited">'+complited[i]["title"]+'</h5><h6 class="card-title-complited complited">завершено</h6></div>\n<div class="card-body">\n<p class="card-text card-title-complited">'+complited[i]['task']+'</p>\n</div>\n</div>\n';
        }
        m.innerHTML=cards;    
    }
    function getTasks() {
        let send={"action":"get-tasks"}
        $.ajax({
            url: '/tasks/managetasks',
            method: 'get',
            dataType: 'json',
            data: send,
            success: function (data) {
                createTasks(data["active"], data["complited"]);
            },
            error: function () {
                console.log("Ошибка подключения к серверу");
            }
        });
        setTimeout(getTasks, 60000);
    }
    getTasks();
</script>
{%endblock scripts%}